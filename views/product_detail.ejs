<%
var dataChartPlots = __.map(tweetCountLogModels, function (m) {
    return '["' + m.createdAt + '",' + m.buzz + ']';
}).join(',');

var productTypeBundleId = Const.PRODUCT_TYPE_ID_TO_BELONGED_PRODUCT_TYPE_BUNDLE_ID[productModel.productTypeId];
var productTypeBundleName = Const.PRODUCT_TYPE_BUNDLE_ID_TO_NAME_HASH[productTypeBundleId];
var productModelName = productModel._modelOptions.name.singular;
var productDetailTemplatePath = 'product_detail/' + productModelName + '.ejs';
var twitterAltSearchWordsStr = __.chain(twitterAltSearchModels)
        .filter(m => {
          return m.isValid();
        })
        .map(m => {
            return m.searchWord;
        })
        .value()
        .join(', ') || productModel.title;

var TITLE_DEFAULT = Const.PRODUCT_TYPE_BUNDLE_ID_TO_JA_NAME_HASH[productTypeBundleId] + ' ' + productModel.title + 'のネットの評価、レビュー、反応【BuzzRanking】';
var DESC_PRODUCT_DEFAULT = productModel.title + 'は本当に買いなのか？SNSから分かるリアルな評判をまとめてみました。' + productModel.title + 'が気になっている方、ご購入を考えている方は必見です！';

var PRODUCT_TYPE_ID_TO_ALT_TITLE_HASH = {
    [Const.PRODUCT_TYPE_NAME_TO_ID_HASH['comic']]: {
        title: '漫画 ' + productModel.title + 'を読むべき理由まとめ ネットの注目度、評判は？',
        description: DESC_PRODUCT_DEFAULT,
    },
    [Const.PRODUCT_TYPE_NAME_TO_ID_HASH['novel']]: {
        title: '小説 ' + productModel.title + 'を読むべき理由まとめ ネットの注目度、評判は？',
        description: DESC_PRODUCT_DEFAULT,
    },
    [Const.PRODUCT_TYPE_NAME_TO_ID_HASH['it']]: {
        title: '技術書 ' + productModel.title + 'を読むべき理由まとめ ネットの注目度、評判は？',
        description: DESC_PRODUCT_DEFAULT,
    },
    [Const.PRODUCT_TYPE_NAME_TO_ID_HASH['console_game']]: {
        title: productModel.title + 'をプレイすべき理由まとめ ネットの注目度、評判は？',
        description: DESC_PRODUCT_DEFAULT,
    },
    [Const.PRODUCT_TYPE_NAME_TO_ID_HASH['portable_game']]: {
        title: productModel.title + 'をプレイすべき理由まとめ ネットの注目度、評判は？',
        description: DESC_PRODUCT_DEFAULT,
    },
    [Const.PRODUCT_TYPE_NAME_TO_ID_HASH['dating_service']]: {
        title: productModel.title + 'が本当に出会える理由まとめ ネットの注目度、評判は？',
        description: productModel.title + 'って本当に出会えるの？SNSから分かるリアルな評判をまとめてみました。' + productModel.title + 'が気になっている方、利用を考えている方は必見です！',
    },
    [Const.PRODUCT_TYPE_NAME_TO_ID_HASH['inn_reservation']]: {
        title: 'ホテル・宿泊予約ならここ！' + productModel.title + 'で予約するべき理由まとめ ネットの注目度、評判は？',
        description: productModel.title + 'で予約しておけば安心？SNSから分かるリアルな評判をまとめてみました。' + productModel.title + 'が気になっている方、利用を考えている方は必見です！',
    },
    [Const.PRODUCT_TYPE_NAME_TO_ID_HASH['anime']]: {
        title: productModel.title + 'を観るべき理由まとめ ネットの注目度、評判は？',
        description: productModel.title + 'は絶対に観ておくべき！？SNSから分かるリアルな評判をまとめてみました。' + productModel.title + 'が気になっている方は必見です！',
    },
};

var target = PRODUCT_TYPE_ID_TO_ALT_TITLE_HASH[productModel.productTypeId];
var title = target.title || TITLE_DEFAULT;
var description = target.description || DESC_PRODUCT_DEFAULT;
%>

<!DOCTYPE html>
<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
      integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
<link href="/css/common.css" rel="stylesheet">
<link href="/css/product_detail.css" rel="stylesheet">

<html>
<head>
    <title>
        <%= title %>
    </title>
    <meta name="viewport"
          content="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="description" content="<%= description %>">
</head>
<body>

<%- include('header.ejs') %>

<div id="content" class="container-fluid">
    <%- include(appRoot + '/public/ad/adsense/horizontal.html') %>

    <%- include(productDetailTemplatePath, { dataChartPlots: dataChartPlots, twitterAltSearchWordsStr: twitterAltSearchWordsStr, }) %>

    <div class="pt-3">
        <%- include('product_detail/top_3_ranking_ad.ejs', { dataChartPlots: dataChartPlots, }) %>
    </div>

    <% if (productModel.isValid()) { %>
        <div class="row">
            <div class="col-12 text-align-center">
                <h2>
                    <span class="no-wrap"><%= productModel.title + (productModel.subTitle ? ' ' + productModel.subTitle : '') %></span><span
                            class="no-wrap">のネットの反応</span>
                </h2>
            </div>
        </div>

        <div class="row mx-auto tweet-reference-block">
            <div class="col-12 text-align-center">
                <span id="tweet-list-load-spin" class="spinner-border text-primary" role="status" aria-hidden="true"></span>
                <div class="related-tweet">
                    <!-- tweet list -->
                </div>
            </div>
        </div>

        <div class="pt-3">
            <%- include('product_detail/top_3_ranking_ad.ejs', { dataChartPlots: dataChartPlots, }) %>
        </div>

    <% } else { %>
        <div class="row">
            <div class="col-12 invalid-product-description">
                ※こちらの商品は正確なBuzz度の測定が困難であると判断されたため、ランキング及び関連ツイート表示の対象外となっています。
            </div>
        </div>
    <% } %>

</div>

<%- include('footer.ejs') %>

</body>
</html>

<script src="/js/compressed/product_detail.min.js" type="text/javascript"></script>
